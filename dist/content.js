let s=!1,o=[],u=null,c=null,i=null,a=null;function f(e){s=!0,o=[],u={id:Date.now().toString(),name:e,description:"",actions:[],createdAt:new Date},c=t=>{if(!s)return;const n=t.target,l=d(n);o.push({type:"click",selector:l,x:t.clientX,y:t.clientY,delay:100})},i=t=>{if(!s)return;const n=t.target,l=d(n);o.push({type:"input",selector:l,value:n.value,delay:50})},a=t=>{s&&o.push({type:"keypress",value:t.key,delay:50})},document.addEventListener("click",c,!0),document.addEventListener("input",i,!0),document.addEventListener("keydown",a,!0),r("매크로 녹화가 시작되었습니다. 페이지에서 마우스 클릭과 키보드 입력을 기록합니다.","info")}function y(){s=!1,c&&(document.removeEventListener("click",c,!0),c=null),i&&(document.removeEventListener("input",i,!0),i=null),a&&(document.removeEventListener("keydown",a,!0),a=null),u&&o.length>0&&(u.actions=o,chrome.runtime.sendMessage({type:"RECORDED_ACTIONS",actions:o})),r("매크로 녹화가 완료되었습니다.","success")}async function m(e){r(`${e.name} 매크로를 실행합니다...`,"info");for(const t of e.actions)try{await k(t),await p(t.delay||100)}catch(n){console.error("매크로 실행 오류:",n),r("매크로 실행 중 오류가 발생했습니다.","error");return}chrome.runtime.sendMessage({type:"MACRO_COMPLETED"}),r(`${e.name} 매크로 실행이 완료되었습니다.`,"success")}async function k(e){switch(e.type){case"click":if(e.selector){const t=document.querySelector(e.selector);t&&t.click()}break;case"input":if(e.selector&&e.value!==void 0){const t=document.querySelector(e.selector);t&&(t.value=e.value,t.dispatchEvent(new Event("input",{bubbles:!0})))}break;case"keypress":e.value&&document.dispatchEvent(new KeyboardEvent("keydown",{key:e.value}));break;case"wait":await p(e.delay||1e3);break;case"scroll":window.scrollTo(e.x||0,e.y||0);break}}function d(e){if(e.id)return`#${e.id}`;if(e.className){const t=e.className.split(" ").filter(n=>n.trim());if(t.length>0)return`.${t.join(".")}`}return e.tagName.toLowerCase()}function p(e){return new Promise(t=>setTimeout(t,e))}function r(e,t="info"){const n=document.createElement("div");switch(n.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 16px;
    border-radius: 8px;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    z-index: 10000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
  `,t){case"success":n.style.backgroundColor="#10b981";break;case"error":n.style.backgroundColor="#ef4444";break;default:n.style.backgroundColor="#3b82f6"}n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},300)},3e3)}chrome.runtime.onMessage.addListener((e,t,n)=>{switch(e.type){case"START_RECORDING":f(e.macroName);break;case"STOP_RECORDING":y();break;case"PLAY_MACRO":m(e.macro);break;case"TICKETING_SITE_DETECTED":r("티켓팅 사이트가 감지되었습니다. 매크로를 사용할 수 있습니다.","info");break}});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{console.log("Ticketing Macro content script loaded")}):console.log("Ticketing Macro content script loaded");
